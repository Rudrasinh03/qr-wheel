<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AR Luxury Data Spin - Fixed Codes</title>

<!-- A-Frame / MindAR -->
<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
:root{
  --gold:#d4af37;--gold-light:#f7e7a5;--gold-dark:#8a6d1c;--dark-bg:rgba(10,10,10,0.95);
}
html,body{height:100%;margin:0;font-family:'Montserrat',sans-serif;background:transparent;overflow:hidden;}
#status{position:fixed;bottom:12px;left:50%;transform:translateX(-50%);color:#fff;background:rgba(0,0,0,0.6);padding:6px 12px;border-radius:10px;z-index:9999;font-size:13px;}
.choice-btn{background:linear-gradient(135deg,var(--gold),var(--gold-light));border:2px solid var(--gold-dark);padding:14px 32px;border-radius:30px;color:#000;font-weight:800;font-size:18px;cursor:pointer;box-shadow:0 0 20px rgba(212,175,55,0.4);}

/* UI positions */
#arChoices{position:fixed;bottom:84px;left:50%;transform:translateX(-50%);display:none;z-index:9999;}
#playerForm,#otpForm,#resultBox{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:85%;max-width:360px;background:var(--dark-bg);border:2px solid var(--gold);border-radius:15px;padding:20px;z-index:25000;text-align:center;box-shadow:0 0 40px rgba(0,0,0,0.9);backdrop-filter:blur(6px);}
.input-group{margin-bottom:12px;text-align:left;}
.input-group label{color:#fff;font-size:13px;display:block;margin-bottom:6px;}
.custom-input{width:100%;padding:10px;border-radius:8px;border:1px solid #444;background:rgba(255,255,255,0.06);color:#fff;font-size:15px;box-sizing:border-box;}
.submit-btn{width:100%;background:var(--gold);border:none;padding:12px;border-radius:8px;font-weight:800;font-size:16px;cursor:pointer;margin-top:6px;color:#000;}
#wheelContainer{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:20000;width:min(90vw,380px);height:min(90vw,380px);}
canvas#wheelCanvas{width:100%;height:100%;filter:drop-shadow(0 0 15px rgba(0,0,0,0.8));transition:transform 4s cubic-bezier(0.1,0,0.2,1);}
#pointer{position:absolute;top:-35px;left:50%;transform:translateX(-50%);z-index:21000;width:60px;height:70px;background:linear-gradient(to bottom,var(--gold-light),var(--gold),var(--gold-dark));clip-path:polygon(50% 100%,100% 0,50% 25%,0 0);}
#rewardMsg{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);padding:20px 30px;background:rgba(0,0,0,0.92);border:2px solid var(--gold);color:var(--gold);font-size:20px;font-weight:800;border-radius:12px;z-index:26000;}
.muted{color:#bbb;font-size:13px;margin-top:6px;}
.small{font-size:13px;color:#fff;}
</style>
</head>

<body>

<div id="status">ðŸ“· Point camera at image</div>
<div id="arChoices"><button id="choice1" class="choice-btn">ENTER TO SPIN</button></div>

<div id="playerForm">
  <h2 style="color:var(--gold)">Player Details</h2>
  <div class="input-group"><label>Full name</label><input id="pName" class="custom-input"></div>
  <div class="input-group"><label>Email</label><input id="pEmail" class="custom-input"></div>
  <div class="input-group"><label>Phone</label><input id="pPhone" class="custom-input"></div>
  <button id="savePlayerBtn" class="submit-btn">Save & Continue</button>
  <div class="muted">We use this to send OTP and prevent abuse.</div>
</div>

<div id="wheelContainer">
  <canvas id="wheelCanvas" width="800" height="800"></canvas>
  <div id="pointer"></div>
</div>

<div id="rewardMsg"></div>

<div id="otpForm">
  <h2 style="color:var(--gold)">Enter OTP</h2>
  <div class="input-group"><input id="otpInput" class="custom-input"></div>
  <button id="verifyOtpBtn" class="submit-btn">Verify OTP</button>
  <div id="otpInfo" class="muted"></div>
</div>

<div id="resultBox">
  <h2 id="resultTitle" style="color:var(--gold)"></h2>
  <div id="resultSub" class="small"></div>
</div>

<a-scene mindar-image="imageTargetSrc: targets.mind; autoStart: true;">
  <a-assets>
    <video id="myVideo" src="https://ik.imagekit.io/arbyrudra/sample.mp4" playsinline></video>
  </a-assets>
  <a-camera></a-camera>
  <a-entity mindar-image-target="targetIndex:0">
    <a-video src="#myVideo"></a-video>
  </a-entity>
</a-scene>

<script>
const WEBHOOK_URL = "https://script.google.com/macros/s/AKfycbzGhvlCPaaeK6oApJXT3yBszywUSSJl05pypgFXr9-KYXMmBqtH1Hw4G6BbmSRQFYJS/exec";
const LOCAL_STORAGE_KEY = "rudra_ar_played_v1";

/* ---------------- HELPER FIX (GITHUB SAFE) ---------------- */
async function sendToWebhook(data){
  const qs = Object.keys(data)
    .map(k => encodeURIComponent(k)+"="+encodeURIComponent(data[k]))
    .join("&");
  const res = await fetch(WEBHOOK_URL+"?"+qs);
  const txt = await res.text();
  try{ return JSON.parse(txt); }catch(e){ return {}; }
}
</script>

</body>
</html>
